# æœ¬åœ°ç·©å­˜æ¨¡å¡Šä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬åœ°ç·©å­˜æ¨¡å¡Šç‚ºå¢å¼·ç‰ˆRAGç³»çµ±æä¾›äº†é«˜æ•ˆçš„ç·©å­˜åŠŸèƒ½ï¼Œå¯ä»¥é¡¯è‘—æå‡é‡è¤‡åˆ†æç›¸åŒé …ç›®æ™‚çš„åŸ·è¡Œé€Ÿåº¦ã€‚ç·©å­˜æ¨¡å¡Šæœƒè‡ªå‹•æª¢æ¸¬é …ç›®è®ŠåŒ–ï¼Œä¸¦åœ¨é …ç›®æœªç™¼ç”Ÿè®ŠåŒ–æ™‚å¾ç·©å­˜åŠ è¼‰çµæœï¼Œé¿å…é‡è¤‡åˆ†æã€‚

## ä¸»è¦åŠŸèƒ½

### 1. æ™ºèƒ½ç·©å­˜ç®¡ç†
- **è‡ªå‹•é …ç›®å“ˆå¸Œè¨ˆç®—**: åŸºæ–¼é …ç›®çµæ§‹å’Œé—œéµæ–‡ä»¶å…§å®¹ç”Ÿæˆå”¯ä¸€å“ˆå¸Œ
- **ç·©å­˜æœ‰æ•ˆæ€§æª¢æŸ¥**: è‡ªå‹•æª¢æ¸¬é …ç›®è®ŠåŒ–ï¼Œç¢ºä¿ç·©å­˜æ•¸æ“šçš„æ™‚æ•ˆæ€§
- **TTLæ”¯æŒ**: æ”¯æŒè¨­ç½®ç·©å­˜ç”Ÿå­˜æ™‚é–“ï¼Œè‡ªå‹•æ¸…ç†éæœŸç·©å­˜
- **çµ±è¨ˆä¿¡æ¯**: æä¾›è©³ç´°çš„ç·©å­˜å‘½ä¸­ç‡ã€ä½¿ç”¨æƒ…æ³çµ±è¨ˆ

### 2. ç·©å­˜é¡å‹æ”¯æŒ
- **åˆ†æçµæœç·©å­˜**: RAGåˆ†æå ±å‘Š
- **è™•ç†çµæœç·©å­˜**: æ•¸æ“šè™•ç†çµæœ
- **å­¸ç¿’çµæœç·©å­˜**: æ™ºèƒ½å­¸ç¿’çµæœ
- **æ±ºç­–çµæœç·©å­˜**: åˆ¤æ–·æ±ºç­–çµæœ

### 3. ç·©å­˜ç®¡ç†åŠŸèƒ½
- **ç·©å­˜æŸ¥è©¢**: æ ¹æ“šé …ç›®è·¯å¾‘å’Œç·©å­˜é¡å‹æŸ¥è©¢ç·©å­˜
- **ç·©å­˜è¨­ç½®**: å°‡åˆ†æçµæœä¿å­˜åˆ°ç·©å­˜
- **ç·©å­˜æ¸…ç†**: æ”¯æŒæŒ‰é …ç›®æˆ–é¡å‹æ¸…ç†ç·©å­˜
- **ç·©å­˜çµ±è¨ˆ**: æŸ¥çœ‹ç·©å­˜ä½¿ç”¨æƒ…æ³å’Œå‘½ä¸­ç‡

## å®‰è£å’Œä½¿ç”¨

### åŸºæœ¬ä½¿ç”¨

```python
from modules.cache_manager import CacheManager, CachedRAGAnalyzer

# å‰µå»ºç·©å­˜ç®¡ç†å™¨ï¼ˆé»˜èªç·©å­˜ç›®éŒ„ï¼š~/.cache/rag-systemï¼‰
cache_manager = CacheManager()

# ä½¿ç”¨å¸¶ç·©å­˜çš„RAGåˆ†æå™¨
cached_analyzer = CachedRAGAnalyzer("/path/to/your/project", cache_manager)

# ç”Ÿæˆåˆ†æå ±å‘Šï¼ˆè‡ªå‹•ä½¿ç”¨ç·©å­˜ï¼‰
report = cached_analyzer.generate_analysis_report()
```

### å‘½ä»¤è¡Œæ¸¬è©¦

```bash
# æ¸¬è©¦ç·©å­˜ç®¡ç†å™¨
python3 test_cache_module.py

# æ¸¬è©¦ç·©å­˜æ¨¡å¡Š
python3 modules/cache_manager.py /path/to/test/project
```

## API åƒè€ƒ

### CacheManager é¡

#### åˆå§‹åŒ–
```python
CacheManager(cache_dir=None, ttl_hours=24)
```
- `cache_dir`: ç·©å­˜ç›®éŒ„è·¯å¾‘ï¼ˆé»˜èªï¼š~/.cache/rag-systemï¼‰
- `ttl_hours`: ç·©å­˜ç”Ÿå­˜æ™‚é–“ï¼ˆå°æ™‚ï¼Œé»˜èª24å°æ™‚ï¼‰

#### ä¸»è¦æ–¹æ³•

**ç²å–ç·©å­˜æ•¸æ“š**
```python
get(project_path: str, cache_type: str) -> Optional[Dict[str, Any]]
```
- `project_path`: é …ç›®è·¯å¾‘
- `cache_type`: ç·©å­˜é¡å‹ï¼ˆanalysis, processing, learning, decisionï¼‰
- è¿”å›å€¼ï¼šç·©å­˜æ•¸æ“šæˆ–Noneï¼ˆå¦‚æœæœªå‘½ä¸­ï¼‰

**è¨­ç½®ç·©å­˜æ•¸æ“š**
```python
set(project_path: str, cache_type: str, data: Dict[str, Any]) -> bool
```
- `project_path`: é …ç›®è·¯å¾‘
- `cache_type`: ç·©å­˜é¡å‹
- `data`: è¦ç·©å­˜çš„æ•¸æ“š
- è¿”å›å€¼ï¼šæ˜¯å¦æˆåŠŸ

**åˆªé™¤ç·©å­˜**
```python
delete(project_path: str = None, cache_type: str = None) -> int
```
- `project_path`: é …ç›®è·¯å¾‘ï¼ˆNoneè¡¨ç¤ºæ‰€æœ‰é …ç›®ï¼‰
- `cache_type`: ç·©å­˜é¡å‹ï¼ˆNoneè¡¨ç¤ºæ‰€æœ‰é¡å‹ï¼‰
- è¿”å›å€¼ï¼šåˆªé™¤çš„ç·©å­˜æ•¸é‡

**æ¸…ç©ºæ‰€æœ‰ç·©å­˜**
```python
clear() -> int
```
- è¿”å›å€¼ï¼šåˆªé™¤çš„ç·©å­˜æ–‡ä»¶æ•¸é‡

**ç²å–çµ±è¨ˆä¿¡æ¯**
```python
get_stats() -> Dict[str, Any]
```
- è¿”å›å€¼ï¼šåŒ…å«ç·©å­˜çµ±è¨ˆä¿¡æ¯çš„å­—å…¸

**åˆ—å‡ºç·©å­˜é …ç›®**
```python
list_cached_projects() -> List[Dict[str, Any]]
```
- è¿”å›å€¼ï¼šç·©å­˜çš„é …ç›®åˆ—è¡¨

### CachedRAGAnalyzer é¡

#### åˆå§‹åŒ–
```python
CachedRAGAnalyzer(project_path: str, cache_manager: CacheManager = None)
```
- `project_path`: é …ç›®è·¯å¾‘
- `cache_manager`: ç·©å­˜ç®¡ç†å™¨å¯¦ä¾‹ï¼ˆé»˜èªå‰µå»ºæ–°çš„ï¼‰

#### ä¸»è¦æ–¹æ³•

**ç”Ÿæˆåˆ†æå ±å‘Šï¼ˆå¸¶ç·©å­˜ï¼‰**
```python
generate_analysis_report(use_cache: bool = True) -> Dict[str, Any]
```
- `use_cache`: æ˜¯å¦ä½¿ç”¨ç·©å­˜ï¼ˆé»˜èªTrueï¼‰
- è¿”å›å€¼ï¼šåˆ†æå ±å‘Š

**ä¿å­˜å ±å‘Šï¼ˆåŒæ™‚æ›´æ–°ç·©å­˜ï¼‰**
```python
save_report(report: Dict[str, Any], output_path: str = None) -> str
```
- `report`: åˆ†æå ±å‘Š
- `output_path`: è¼¸å‡ºæ–‡ä»¶è·¯å¾‘
- è¿”å›å€¼ï¼šä¿å­˜çš„æ–‡ä»¶è·¯å¾‘

## é›†æˆåˆ°ç¾æœ‰ç³»çµ±

### 1. ä¿®æ”¹ç¾æœ‰æ¨¡å¡Šä½¿ç”¨ç·©å­˜

åœ¨ç¾æœ‰æ¨¡å¡Šä¸­æ·»åŠ ç·©å­˜æ”¯æŒï¼š

```python
from modules.cache_manager import CacheManager

class YourModule:
    def __init__(self, project_path: str):
        self.project_path = project_path
        self.cache_manager = CacheManager()
    
    def your_method(self, use_cache=True):
        if use_cache:
            cached_data = self.cache_manager.get(self.project_path, "your_cache_type")
            if cached_data is not None:
                print("âœ… å¾ç·©å­˜åŠ è¼‰æ•¸æ“š")
                return cached_data
        
        # åŸ·è¡Œå¯¦éš›æ“ä½œ
        result = self._do_actual_work()
        
        # ä¿å­˜åˆ°ç·©å­˜
        if use_cache:
            self.cache_manager.set(self.project_path, "your_cache_type", result)
            print("ğŸ’¾ æ•¸æ“šå·²ç·©å­˜")
        
        return result
```

### 2. å‰µå»ºå¸¶ç·©å­˜çš„å¢å¼·ç‰ˆç³»çµ±

åƒè€ƒ `main_enhanced.py` å‰µå»ºå¸¶ç·©å­˜çš„ç‰ˆæœ¬ï¼š

```python
class EnhancedRAGSystemWithCache:
    def __init__(self, project_path: str, enable_cache: bool = True):
        self.project_path = project_path
        self.enable_cache = enable_cache
        self.cache_manager = CacheManager() if enable_cache else None
    
    def run_analysis(self):
        # æ¯å€‹éšæ®µéƒ½æª¢æŸ¥ç·©å­˜
        if self.enable_cache:
            cached_data = self.cache_manager.get(self.project_path, "analysis")
            if cached_data:
                return cached_data
        
        # åŸ·è¡Œåˆ†æä¸¦ç·©å­˜çµæœ
        result = self._do_analysis()
        
        if self.enable_cache:
            self.cache_manager.set(self.project_path, "analysis", result)
        
        return result
```

## ç·©å­˜ç­–ç•¥

### 1. ç·©å­˜éµç”Ÿæˆ
ç·©å­˜éµç”±ä»¥ä¸‹éƒ¨åˆ†çµ„æˆï¼š
- ç·©å­˜é¡å‹ï¼ˆanalysis, processing, learning, decisionï¼‰
- é …ç›®è·¯å¾‘å“ˆå¸Œï¼ˆå‰12å€‹å­—ç¬¦ï¼‰
- é …ç›®å…§å®¹å“ˆå¸Œï¼ˆåŸºæ–¼é—œéµæ–‡ä»¶å’Œç›®éŒ„çµæ§‹ï¼‰

### 2. é …ç›®å“ˆå¸Œè¨ˆç®—
é …ç›®å“ˆå¸ŒåŸºæ–¼ï¼š
- é—œéµæ–‡ä»¶ï¼ˆpackage.json, README.md, tsconfig.jsonç­‰ï¼‰çš„ä¿®æ”¹æ™‚é–“å’Œå¤§å°
- ç›®éŒ„çµæ§‹ï¼ˆå‰å…©å±¤ï¼‰
- æ–‡ä»¶åˆ—è¡¨ï¼ˆå‰20å€‹æ–‡ä»¶ï¼‰

### 3. ç·©å­˜å¤±æ•ˆç­–ç•¥
- **TTLéæœŸ**: ç·©å­˜è¶…éè¨­å®šçš„ç”Ÿå­˜æ™‚é–“å¾Œè‡ªå‹•å¤±æ•ˆ
- **é …ç›®è®ŠåŒ–**: é …ç›®å“ˆå¸Œè®ŠåŒ–æ™‚ç·©å­˜è‡ªå‹•å¤±æ•ˆ
- **æ‰‹å‹•æ¸…ç†**: å¯ä»¥æ‰‹å‹•æ¸…ç†ç‰¹å®šé …ç›®æˆ–é¡å‹çš„ç·©å­˜

## æ€§èƒ½å„ªåŒ–å»ºè­°

### 1. èª¿æ•´TTLè¨­ç½®
æ ¹æ“šé …ç›®æ›´æ–°é »ç‡èª¿æ•´ç·©å­˜ç”Ÿå­˜æ™‚é–“ï¼š
```python
# é »ç¹æ›´æ–°çš„é …ç›®ï¼šè¼ƒçŸ­çš„TTL
cache_manager = CacheManager(ttl_hours=6)

# ç©©å®šçš„é …ç›®ï¼šè¼ƒé•·çš„TTL
cache_manager = CacheManager(ttl_hours=72)
```

### 2. ç·©å­˜ç›®éŒ„å„ªåŒ–
- ä½¿ç”¨SSDå­˜å„²æå‡ç·©å­˜è®€å¯«é€Ÿåº¦
- å®šæœŸæ¸…ç†éæœŸç·©å­˜é‡‹æ”¾ç£ç›¤ç©ºé–“
- è€ƒæ…®ä½¿ç”¨å…§å­˜ç·©å­˜ï¼ˆå¦‚Redisï¼‰æå‡æ€§èƒ½

### 3. ç›£æ§ç·©å­˜ä½¿ç”¨
å®šæœŸæª¢æŸ¥ç·©å­˜çµ±è¨ˆï¼Œå„ªåŒ–ç·©å­˜ç­–ç•¥ï¼š
```python
stats = cache_manager.get_stats()
print(f"å‘½ä¸­ç‡: {stats['hit_rate_percent']}%")
print(f"ç·©å­˜å¤§å°: {stats['total_size_mb']:.2f} MB")
```

## æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

**1. ç·©å­˜æœªå‘½ä¸­ç‡éé«˜**
- æª¢æŸ¥é …ç›®æ˜¯å¦é »ç¹è®ŠåŒ–
- ç¢ºèªç·©å­˜éµç”Ÿæˆé‚è¼¯æ˜¯å¦æ­£ç¢º
- æª¢æŸ¥ç·©å­˜ç›®éŒ„æ¬Šé™

**2. ç·©å­˜æ•¸æ“šéæœŸ**
- èª¿æ•´TTLè¨­ç½®
- å¯¦ç¾æ‰‹å‹•ç·©å­˜åˆ·æ–°æ©Ÿåˆ¶
- æ·»åŠ ç·©å­˜ç‰ˆæœ¬æ§åˆ¶

**3. ç·©å­˜ç›®éŒ„ç©ºé–“ä¸è¶³**
- å®šæœŸæ¸…ç†éæœŸç·©å­˜
- è¨­ç½®ç·©å­˜å¤§å°é™åˆ¶
- ä½¿ç”¨å¤–éƒ¨å­˜å„²æœå‹™

### èª¿è©¦æ–¹æ³•

```python
# å•Ÿç”¨è©³ç´°æ—¥èªŒ
import logging
logging.basicConfig(level=logging.DEBUG)

# æª¢æŸ¥ç·©å­˜ç‹€æ…‹
cache_manager = CacheManager()
print("ç·©å­˜ç›®éŒ„:", cache_manager.cache_dir)
print("ç´¢å¼•æ–‡ä»¶:", cache_manager.index_file)

# æ‰‹å‹•æ¸…ç†ç·©å­˜
deleted = cache_manager.clear()
print(f"æ¸…ç†äº† {deleted} å€‹ç·©å­˜æ–‡ä»¶")
```

## æœ€ä½³å¯¦è¸

1. **æ¼¸é€²å¼é›†æˆ**: å…ˆåœ¨éé—œéµæ¨¡å¡Šæ¸¬è©¦ç·©å­˜åŠŸèƒ½
2. **ç›£æ§ç·©å­˜å‘½ä¸­ç‡**: ç¢ºä¿ç·©å­˜å¸¶ä¾†æ€§èƒ½æå‡
3. **å®šæœŸç¶­è­·**: æ¸…ç†éæœŸç·©å­˜ï¼Œå„ªåŒ–ç·©å­˜ç­–ç•¥
4. **å‚™ä»½é‡è¦æ•¸æ“š**: ç·©å­˜ä¸æ‡‰æ›¿ä»£æŒä¹…åŒ–å­˜å„²
5. **æ¸¬è©¦ç·©å­˜å¤±æ•ˆ**: ç¢ºä¿é …ç›®è®ŠåŒ–æ™‚ç·©å­˜æ­£ç¢ºå¤±æ•ˆ

## æ“´å±•é–‹ç™¼

### æ·»åŠ æ–°çš„ç·©å­˜é¡å‹
1. åœ¨ `_generate_cache_key` æ–¹æ³•ä¸­æ·»åŠ æ–°çš„ç·©å­˜é¡å‹
2. å‰µå»ºå°æ‡‰çš„ç·©å­˜ç®¡ç†æ–¹æ³•
3. åœ¨ç›¸é—œæ¨¡å¡Šä¸­é›†æˆæ–°ç·©å­˜é¡å‹

### æ”¯æŒåˆ†å¸ƒå¼ç·©å­˜
1. å¯¦ç¾ç·©å­˜æ¥å£æŠ½è±¡
2. æ·»åŠ Redisã€Memcachedç­‰åç«¯æ”¯æŒ
3. å¯¦ç¾ç·©å­˜åŒæ­¥æ©Ÿåˆ¶

### æ·»åŠ ç·©å­˜å£“ç¸®
1. å¯¦ç¾æ•¸æ“šå£“ç¸®/è§£å£“æ–¹æ³•
2. æ·»åŠ å£“ç¸®é¸é …é…ç½®
3. å„ªåŒ–å¤§æ•¸æ“šç·©å­˜æ€§èƒ½

## ç‰ˆæœ¬æ­·å²

### v1.0.0 (åˆå§‹ç‰ˆæœ¬)
- åŸºç¤ç·©å­˜ç®¡ç†å™¨å¯¦ç¾
- æ”¯æŒå››ç¨®ç·©å­˜é¡å‹
- TTLéæœŸæ©Ÿåˆ¶
- è©³ç´°çµ±è¨ˆä¿¡æ¯

### v1.1.0 (è¨ˆåŠƒä¸­)
- ç·©å­˜å£“ç¸®æ”¯æŒ
- åˆ†å¸ƒå¼ç·©å­˜åç«¯
- ç·©å­˜é ç†±åŠŸèƒ½
- æ€§èƒ½ç›£æ§å„€è¡¨æ¿

---

**æ³¨æ„**: ç·©å­˜æ¨¡å¡Šæ—¨åœ¨æå‡é‡è¤‡åˆ†ææ€§èƒ½ï¼Œä½†ä¸æ‡‰æ›¿ä»£æŒä¹…åŒ–å­˜å„²ã€‚é‡è¦æ•¸æ“šè«‹ç¢ºä¿æœ‰å‚™ä»½æ©Ÿåˆ¶ã€‚